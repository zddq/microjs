const e=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function t(t,i,r={}){const n=r||{};if(!e.test(t))throw new TypeError("argument name is invalid");const o=encodeURIComponent(JSON.stringify(i).trim());if(o&&!e.test(o))throw new TypeError("argument val is invalid");let s=`${t}=${o}`;if(n.domain){if(!e.test(n.domain))throw new TypeError("option domain is invalid");s+=`; Domain=${n.domain}`}if(n.path){if(!e.test(n.path))throw new TypeError("option path is invalid");s+=`; Path=${n.path}`}if(n.expires){if(!function(e){return"[object Date]"===Object.prototype.toString.call(e)||e instanceof Date}(n.expires))throw new TypeError("option expires is invalid");s+=`; Expires=${n.expires.toUTCString()}`}if("number"==typeof n.maxAge){if(isNaN(n.maxAge)||!isFinite(n.maxAge))throw new TypeError("option maxAge is invalid");s+=`; Max-Age=${Math.floor(n.maxAge)}`}if(n.httpOnly&&(s+="; HttpOnly"),n.secure&&(s+="; Secure"),n.sameSite){if("Strict"!==n.sameSite&&"Lax"!==n.sameSite&&"None"!==n.sameSite)throw new TypeError("option sameSite invalid, sameSite must be Strict | Lax |None");s+=`; SameSite=${n.sameSite}`}if(n.partitioned&&(s+="; Partitioned"),n.priority){if("High"!==n.priority&&"Medium"!==n.priority&&"Low"!==n.priority)throw new TypeError("option priority invalid, priority muse be High | Medium | Low");s+=`; Priority=${n.priority}`}return s}var i=new class{constructor(e={}){this.config={},this.config=e}serialize(e,i,r={}){return t(e,i,Object.assign(Object.assign({},this.config),r))}parse(e){try{if(!e||"string"!=typeof e)return{};const t=function(e){try{return e.includes("%")?decodeURIComponent(e):e}catch(t){return e}}(e).split(";").filter(Boolean);return t.map((e=>e.split("="))).reduce(((e,[t,i=""])=>{const r=t.trim(),n=i.trim();try{return Object.assign(Object.assign({},e),{[r]:JSON.parse(n)})}catch(t){return Object.assign(Object.assign({},e),{[r]:n})}}),{})}catch(e){return console.error("cookie parse err:",e),{}}}get(e,t={}){try{const i=Object.assign(Object.assign({},this.config),t);return"undefined"!=typeof window?this.parse(document.cookie)[e]:this.parse(i.ctx.req.headers.cookie||"")[e]}catch(t){return console.error("cookie get err:",t),this.parse("")[e]}}set(e,t,i={}){try{const r=Object.assign(Object.assign({},this.config),i);if("undefined"!=typeof window&&r.httpOnly)throw new Error("Can not set a httpOnly cookie in the browser.");const n=this.serialize(String(e),t,r);return"undefined"!=typeof window?(document.cookie=n,!0):!!r.ctx&&(r.ctx.res.setHeader("'Set-Cookie'",n),!0)}catch(e){return console.error("cookie set err:",e),!1}}del(e,t={}){return this.set(e,"",Object.assign(Object.assign(Object.assign({},this.config),t),{maxAge:-1}))}has(e,t={}){try{const i=Object.assign(Object.assign({},this.config),t);return"undefined"!=typeof window?!!this.parse(document.cookie)[e]:!!i.ctx&&!!this.parse(i.ctx.req.headers.cookie||"")[e]}catch(e){return console.error("cookie has err:",e),!1}}init(e){return this.config=Object.assign(Object.assign({},this.config),e),this}};export{i as default};
